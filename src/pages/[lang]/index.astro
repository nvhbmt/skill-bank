---
import DefaultLayout from '@/layouts/DefaultLayout.astro';
import Header from '@/components/Header.astro';
import Footer from '@/components/Footer.astro';
// Import CSS bằng đường dẫn tương đối để chắc chắn hoạt động
import '@/assets/css/homepage.css';
import { getStaticPaths, useTranslate } from '@/i18n';
import ProjectCard from '@/components/ProjectCard.astro';
import { getFeaturedProjects } from '@/services/projects';
import { getFeaturedProfiles } from '@/services/user-profile';
export { getStaticPaths };

const { t, l } = useTranslate(Astro);

// Xử lý text tiêu đề an toàn
const heroTitle = t('home.heroTitle') || 'SkillBank\nPlatform';
const titleParts = heroTitle.includes('\n')
    ? heroTitle.split('\n')
    : [heroTitle, ''];

// Load featured projects and profiles from database
const featuredProjects = await getFeaturedProjects();
const featuredProfiles = await getFeaturedProfiles();
---

<DefaultLayout>
    <!-- Wrapper với background động -->
    <div class="home-wrapper">
        <div class="grid-overlay"></div>
        <!-- Blobs Background -->
        <div class="blob blob-1"></div>
        <div class="blob blob-2"></div>
        <div class="blob blob-3"></div>

        <Header />

        <main>
            <div class="home-container">
                <!-- 1. HERO SECTION -->
                <section class="hero-section">
                    <div class="hero-content">
                        <h1 class="hero-title">
                            {titleParts[0]}
                            <br />
                            <span class="text-gradient">{titleParts[1]}</span>
                        </h1>
                        <p class="hero-subtitle">{t('home.heroSubtitle')}</p>
                        <div class="hero-buttons">
                            <a href={l('/explore')} class="btn-hero-primary"
                                >{t('home.btnExplore')}</a
                            >
                            <a
                                href={l('/create-project')}
                                class="btn-hero-secondary"
                                >{t('home.btnPost')}</a
                            >
                        </div>
                    </div>
                    <div class="hero-image">
                        <img
                            src="/assets/images/handshake.png"
                            alt="Abstract Tech"
                            class="hero-img-main"
                        />
                    </div>
                </section>

                <!-- 2. TECH MARQUEE -->
                <section class="tech-marquee">
                    <div class="marquee-content">
                        <div class="tech-item">
                            <i class="fa-brands fa-react"></i> React
                        </div>
                        <div class="tech-item">
                            <i class="fa-brands fa-node-js"></i> Node.js
                        </div>
                        <div class="tech-item">
                            <i class="fa-brands fa-python"></i> Python
                        </div>
                        <div class="tech-item">
                            <i class="fa-brands fa-vuejs"></i> Vue
                        </div>
                        <div class="tech-item">
                            <i class="fa-brands fa-docker"></i> Docker
                        </div>
                        <div class="tech-item">
                            <i class="fa-brands fa-aws"></i> AWS
                        </div>
                        <div class="tech-item">
                            <i class="fa-brands fa-figma"></i> Figma
                        </div>
                        <!-- Repeat for infinite scroll -->
                        <div class="tech-item">
                            <i class="fa-brands fa-react"></i> React
                        </div>
                        <div class="tech-item">
                            <i class="fa-brands fa-node-js"></i> Node.js
                        </div>
                        <div class="tech-item">
                            <i class="fa-brands fa-python"></i> Python
                        </div>
                        <div class="tech-item">
                            <i class="fa-brands fa-vuejs"></i> Vue
                        </div>
                    </div>
                </section>

                <!-- 3. STATS SECTION -->
                <section class="section-stats">
                    <div class="stats-grid">
                        <div class="stat-card">
                            <span class="stat-number">500+</span><span
                                class="stat-label"
                                >{t('home.statProjects')}</span
                            >
                        </div>
                        <div class="stat-card">
                            <span class="stat-number">1.2k+</span><span
                                class="stat-label">{t('home.statTalents')}</span
                            >
                        </div>
                        <div class="stat-card">
                            <span class="stat-number">850+</span><span
                                class="stat-label"
                                >{t('home.statConnects')}</span
                            >
                        </div>
                        <div class="stat-card">
                            <span class="stat-number">50+</span><span
                                class="stat-label">{t('home.statTechs')}</span
                            >
                        </div>
                    </div>
                </section>

                <!-- 4. FEATURED PROJECTS -->
                <section class="section-projects">
                    <div class="section-header">
                        <h2 class="section-title">
                            {t('home.sectionProjects')}
                        </h2>
                        <div class="section-divider"></div>
                    </div>
                    <div class="projects-grid">
                        {
                            featuredProjects.map((project) => (
                                <ProjectCard project={project} />
                            ))
                        }
                    </div>
                </section>

                <!-- 5. FEATURED PROFILES -->
                <section class="section-profiles">
                    <div class="section-header">
                        <h2 class="section-title">
                            {t('home.sectionProfiles')}
                        </h2>
                        <div class="section-divider"></div>
                    </div>
                    <div class="profiles-grid">
                        {
                            featuredProfiles.length > 0 ? (
                                featuredProfiles.map((profile) => (
                                    <a
                                        href={l(`/profile/${profile.username}`)}
                                        class="profile-card"
                                    >
                                        <img
                                            src={profile.avatar}
                                            alt={profile.name}
                                            class="profile-avatar"
                                        />
                                        <h3 class="profile-name">
                                            {profile.name}
                                        </h3>
                                        <p class="profile-role">
                                            {profile.role}
                                        </p>
                                        <div class="profile-skills">
                                            {profile.skills.map((skill) => (
                                                <span class="skill-pill">
                                                    {skill}
                                                </span>
                                            ))}
                                        </div>
                                        <div class="profile-rating">
                                            {Array(profile.rating)
                                                .fill('★')
                                                .join('')}
                                        </div>
                                    </a>
                                ))
                            ) : (
                                <p style="color: #9ca3af; text-align: center; grid-column: 1 / -1;">
                                    Chưa có profile nổi bật.
                                </p>
                            )
                        }
                    </div>
                </section>

                <!-- 6. FAQ & CTA -->
                <section class="section-faq">
                    <div class="section-header">
                        <h2 class="section-title">{t('home.sectionFAQ')}</h2>
                        <div class="section-divider"></div>
                    </div>
                    <div class="faq-container">
                        <details class="faq-item">
                            <summary class="faq-summary"
                                >{t('home.faq1_q')}</summary
                            ><div class="faq-answer">{t('home.faq1_a')}</div>
                        </details>
                        <details class="faq-item">
                            <summary class="faq-summary"
                                >{t('home.faq2_q')}</summary
                            ><div class="faq-answer">{t('home.faq2_a')}</div>
                        </details>
                        <details class="faq-item">
                            <summary class="faq-summary"
                                >{t('home.faq3_q')}</summary
                            ><div class="faq-answer">{t('home.faq3_a')}</div>
                        </details>
                    </div>
                </section>

                <section class="section-cta">
                    <div class="cta-section">
                        <div class="cta-content">
                            <h2 class="cta-title">{t('home.ctaTitle')}</h2>
                            <p class="cta-subtitle">{t('home.ctaSubtitle')}</p>
                            <a href={l('/sign-up')} class="btn-cta-large"
                                >{t('home.ctaBtn')}</a
                            >
                        </div>
                    </div>
                </section>
            </div>
        </main>

        <Footer />
    </div>
</DefaultLayout>
