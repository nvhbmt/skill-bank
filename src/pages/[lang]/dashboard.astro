---
import DefaultLayout from '@/layouts/DefaultLayout.astro';
import Header from '@/components/Header.astro';
import Footer from '@/components/Footer.astro';
import '@/assets/css/dashboard.css';
import { getStaticPaths, useTranslate } from '@/i18n';
export { getStaticPaths };

const { t, l } = useTranslate(Astro);
const session = Astro.locals.session;

if (!session?.user) {
    return Astro.redirect(l('/sign-in'));
}

const user = session.user;
const userName = user?.user_metadata?.full_name || 'User';

// Mock Data
const stats = {
    reputation: 850,
    likes: 120,
    views: 412,
    invites: 3,
};

const recommendedProjects = [
    {
        id: 301,
        title: 'DeFi Dashboard Interface',
        image: 'https://images.unsplash.com/photo-1639322537228-f710d846310a?q=80&w=400&auto=format&fit=crop',
        tags: ['Figma', 'Web3'],
        author: 'CryptoLabs',
        likes: 315,
        dislikes: 5,
        match: 98,
    },
    {
        id: 302,
        title: 'AI Content Generator App',
        image: 'https://images.unsplash.com/photo-1677442136019-21780ecad995?q=80&w=400&auto=format&fit=crop',
        tags: ['Python', 'AI'],
        author: 'StartupAI',
        likes: 520,
        dislikes: 12,
        match: 92,
    },
    {
        id: 303,
        title: 'Travel Booking Mobile App',
        image: 'https://images.unsplash.com/photo-1469854523086-cc02fe5d8800?q=80&w=400&auto=format&fit=crop',
        tags: ['Flutter', 'Mobile'],
        author: 'TravelX',
        likes: 280,
        dislikes: 8,
        match: 85,
    },
];

const activities = [
    { type: 'applied', project: 'Smart Home IoT', time: '2h ago' },
    { type: 'posted', project: 'Travel Booking UI', time: '1d ago' },
    { type: 'joined', project: 'Fintech App', time: '3d ago' },
];

const trendingSkills = [
    { name: 'React Native', count: '+12%' },
    { name: 'Node.js', count: '+8%' },
    { name: 'UX Research', count: '+15%' },
    { name: 'Golang', count: '+5%' },
    { name: '3D Design', count: '+20%' },
];
---

<DefaultLayout>
    <div class="wrapper">
        <div class="grid-overlay"></div>
        <div class="blob blob-1"></div>
        <div class="blob blob-2"></div>
        <div class="blob blob-3"></div>

        <Header />

        <main>
            <div class="dashboard-container">
                <!-- 1. HEADER -->
                <div class="dashboard-header">
                    <div class="welcome-text">
                        <!-- THÃŠM ICON VáºªY TAY -->
                        <h1>
                            {t('dashboard.welcome')}
                            <span>{userName}</span>! <span class="wave-hand"
                                >ðŸ‘‹</span
                            >
                        </h1>
                        <p>{t('dashboard.subtitle')}</p>
                    </div>
                    <div class="date-badge">
                        {
                            new Date().toLocaleDateString('vi-VN', {
                                weekday: 'long',
                                day: 'numeric',
                                month: 'long',
                            })
                        }
                    </div>
                </div>

                <!-- 2. STATS (GAMIFICATION) -->
                <div class="stats-grid">
                    <!-- Card 1: Uy tÃ­n -->
                    <div class="stat-card">
                        <div class="stat-icon-box">
                            <i class="fa-solid fa-star"></i>
                        </div>
                        <div class="stat-info">
                            <h3 class="stat-value">{stats.reputation}</h3>
                            <p class="stat-label">
                                {t('dashboard.statReputation')}
                            </p>
                        </div>
                    </div>

                    <!-- Card 2: Tá»•ng lÆ°á»£t thÃ­ch -->
                    <div class="stat-card">
                        <div class="stat-icon-box">
                            <i class="fa-solid fa-thumbs-up"></i>
                        </div>
                        <div class="stat-info">
                            <h3 class="stat-value">{stats.likes}</h3>
                            <p class="stat-label">{t('dashboard.statLikes')}</p>
                        </div>
                    </div>

                    <!-- Card 3: LÆ°á»£t xem -->
                    <div class="stat-card">
                        <div class="stat-icon-box">
                            <i class="fa-regular fa-eye"></i>
                        </div>
                        <div class="stat-info">
                            <h3 class="stat-value">{stats.views}</h3>
                            <p class="stat-label">{t('dashboard.statViews')}</p>
                        </div>
                    </div>

                    <!-- Card 4: Lá»i má»i -->
                    <div class="stat-card">
                        <div class="stat-icon-box">
                            <i class="fa-regular fa-envelope"></i>
                        </div>
                        <div class="stat-info">
                            <h3 class="stat-value">{stats.invites}</h3>
                            <p class="stat-label">
                                {t('dashboard.statInvites')}
                            </p>
                        </div>
                    </div>
                </div>

                <!-- 3. MAIN CONTENT -->
                <div class="dashboard-content">
                    <!-- LEFT COLUMN -->
                    <div class="main-column">
                        <!-- Recommended Projects -->
                        <div class="section-header">
                            <h2 class="section-title">
                                <i class="fa-solid fa-wand-magic-sparkles"></i>
                                {t('dashboard.recommended')}
                            </h2>
                            <a href={l('/explore')} class="view-all-link"
                                >{t('dashboard.viewAll')} &rarr;</a
                            >
                        </div>

                        <div class="projects-grid-mini">
                            {
                                recommendedProjects.map((proj) => (
                                    <a
                                        href={`/project/${proj.id}`}
                                        class="project-card-new"
                                    >
                                        <div class="project-thumb-wrapper">
                                            <img
                                                src={proj.image}
                                                alt={proj.title}
                                                class="project-thumb-new"
                                            />
                                        </div>
                                        <div class="project-info-new">
                                            <div class="project-header-row">
                                                <span class="project-title-new">
                                                    {proj.title}
                                                </span>
                                                <span class="project-tag-badge">
                                                    {proj.tags[0]}
                                                </span>
                                            </div>
                                            <div class="project-stats-row">
                                                <div class="stat-icon">
                                                    <i class="fa-regular fa-thumbs-up" />{' '}
                                                    <span>{proj.likes}</span>
                                                </div>
                                                <div
                                                    class="stat-icon"
                                                    style="color:#4ade80; font-size:0.9rem; font-weight:600;"
                                                >
                                                    {proj.match}% Match
                                                </div>
                                            </div>
                                        </div>
                                    </a>
                                ))
                            }
                        </div>

                        <!-- Trending Skills -->
                        <div class="section-header trending-section">
                            <h2 class="section-title">
                                <i class="fa-solid fa-arrow-trend-up"></i>
                                {t('dashboard.trendingSkills')}
                            </h2>
                        </div>
                        <div class="trending-grid">
                            {
                                trendingSkills.map((skill) => (
                                    <div class="trend-tag">
                                        <i class="fa-solid fa-fire" />{' '}
                                        {skill.name}
                                        <span class="trend-count">
                                            {skill.count}
                                        </span>
                                    </div>
                                ))
                            }
                        </div>
                    </div>

                    <!-- RIGHT COLUMN -->
                    <aside class="dashboard-sidebar">
                        <!-- Profile Strength -->
                        <div class="widget-card profile-strength-box">
                            <h3
                                style="color:white; margin-bottom:1rem; font-size:1.4rem; font-weight:700; align-self: flex-start;"
                            >
                                {t('dashboard.profileStrength')}
                            </h3>
                            <div class="circle-chart">
                                <svg viewBox="0 0 36 36">
                                    <path
                                        class="circle-bg"
                                        d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"
                                    ></path>
                                    <path
                                        class="circle-progress"
                                        stroke-dasharray="85, 100"
                                        d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"
                                    ></path>
                                </svg>
                                <div class="percentage-text">85%</div>
                            </div>
                            <div class="strength-info">
                                <p
                                    style="font-size: 0.9rem; color: #9ca3af; margin-bottom: 1rem;"
                                >
                                    Há»“ sÆ¡ áº¥n tÆ°á»£ng! ThÃªm chá»©ng chá»‰ Ä‘á»ƒ Ä‘áº¡t 100%.
                                </p>
                                <a href={l('/edit-profile')} class="btn-outline"
                                    >{t('dashboard.completeProfile')}</a
                                >
                            </div>
                        </div>

                        <!-- Recent Activity -->
                        <div class="widget-card">
                            <h3
                                style="color:white; margin-bottom:1.5rem; font-size:1.4rem; font-weight:700;"
                            >
                                {t('dashboard.recentActivity')}
                            </h3>
                            <div class="activity-list">
                                {
                                    activities.map((act) => (
                                        <div class="activity-item">
                                            <div class="act-icon">
                                                {act.type === 'applied' && (
                                                    <i class="fa-solid fa-paper-plane" />
                                                )}
                                                {act.type === 'posted' && (
                                                    <i class="fa-solid fa-plus" />
                                                )}
                                                {act.type === 'joined' && (
                                                    <i class="fa-solid fa-handshake" />
                                                )}
                                            </div>
                                            <div class="act-text">
                                                {t(`dashboard.act_${act.type}`)}{' '}
                                                <span>{act.project}</span>
                                                <span class="act-time">
                                                    {act.time}
                                                </span>
                                            </div>
                                        </div>
                                    ))
                                }
                            </div>
                        </div>
                    </aside>
                </div>
            </div>
        </main>
    </div>
    <Footer />
</DefaultLayout>
