---
import DefaultLayout from '@/layouts/DefaultLayout.astro';
import OAuthButtons from '@/components/OAuthButtons.astro';
import '@/assets/css/sign-in.css';
import { getStaticPaths, useTranslate } from '@/i18n';
export { getStaticPaths };

const { lang, t, l } = useTranslate(Astro);
const isLoggedIn = Astro.locals.session?.user;
if (isLoggedIn) {
    return Astro.redirect(l('/'));
}
---

<DefaultLayout>
    <div class="container">
        <div class="login-page">
            <div class="login-page-left">
                <form id="login-form">
                    <div class="inner-login-page-left">
                        <div class="login-content">
                            <div class="login-form">
                                <div
                                    style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;"
                                >
                                    <h1>{t('sign-in.title')}</h1>
                                    <select
                                        id="lang-selector"
                                        style="padding: 0.5rem; border-radius: 4px; border: 1px solid #ccc;"
                                    >
                                        <option
                                            value="vi"
                                            selected={lang === 'vi'}>VI</option
                                        >
                                        <option
                                            value="en"
                                            selected={lang === 'en'}>EN</option
                                        >
                                    </select>
                                </div>
                                <div>
                                    {t('sign-in.noAccount')}
                                    <a href={l('/sign-up')} class="login-link"
                                        >{t('sign-in.signUp')}</a
                                    >
                                </div>
                            </div>
                            <div class="login-form-body">
                                <div class="login-form-item-group">
                                    <div class="login-form-input-wrapper">
                                        <img
                                            src="/assets/images/solar_user-outline.svg"
                                            alt="icon"
                                        />
                                        <input
                                            type="text"
                                            name="username"
                                            placeholder={t('sign-in.username')}
                                            class="login-form-group-text"
                                        />
                                    </div>
                                    <div
                                        id="username-error"
                                        class="login-form-input-error"
                                    >
                                    </div>
                                </div>
                                <div class="login-form-item-group">
                                    <div class="login-form-input-wrapper">
                                        <img
                                            src="/assets/images/material-symbols-light_lock-outline.svg"
                                            alt="icon"
                                        />
                                        <input
                                            type="password"
                                            name="password"
                                            placeholder={t('sign-in.password')}
                                            class="login-form-group-text"
                                        />
                                    </div>
                                    <div
                                        id="password-error"
                                        class="login-form-input-error"
                                    >
                                    </div>
                                </div>
                                <div class="login-form-action">
                                    <label
                                        ><input type="checkbox" />
                                        {t('sign-in.rememberMe')}</label
                                    >
                                    <a
                                        href={l('/forgot-password')}
                                        class="login-link"
                                        >{t('sign-in.forgotPassword')}</a
                                    >
                                </div>
                            </div>
                            <button type="submit" class="login-form-btn"
                                >{t('sign-in.title')}</button
                            >
                        </div>
                        <div class="login-form-divider">
                            <div class="login-form-divider-line"></div>
                            <div class="login-form-divider-text">
                                {t('sign-in.or')}
                            </div>
                            <div class="login-form-divider-line"></div>
                        </div>
                        <OAuthButtons
                            googleText={t('sign-in.gmail')}
                            facebookText={t('sign-in.facebook')}
                            errorGeneric={t('sign-in.errorGeneric')}
                        />
                    </div>
                </form>
            </div>
            <div class="login-page-right"></div>
        </div>
    </div>
</DefaultLayout>

<script
    define:vars={{
        validationMessages: JSON.stringify({
            usernameRequired: t('sign-in.validation.usernameRequired'),
            usernameMinLength: t('sign-in.validation.usernameMinLength'),
            passwordRequired: t('sign-in.validation.passwordRequired'),
            passwordMinLength: t('sign-in.validation.passwordMinLength'),
        }),
        uiMessages: JSON.stringify({
            loading: t('sign-in.loading'),
            error: t('sign-in.error'),
            errorGeneric: t('sign-in.errorGeneric'),
        }),
    }}
>
    window.loginValidationMessages = JSON.parse(validationMessages);
    window.loginUIMessages = JSON.parse(uiMessages);
</script>

<script src="@/assets/script/sign-in.js"></script>
